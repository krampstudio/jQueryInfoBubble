/**
 * jqinfobubble - v0.1.1 
 * @author Bertrand Chevrier <chevrier.bertrand@gmail.com>
 * @license http://www.gnu.org/licenses/gpl-3.0.txt
 */

(function(e){"use strict";var t={_opts:{content:"info bubble",display:!0,position:"right",opacity:.6,arrow:{top:"../resources/arrow_top.png",right:"../resources/arrow_right.png",bottom:"../resources/arrow_bottom.png",left:"../resources/arrow_left.png"},style:{"background-color":"#000",border:"solid 2px #FFF",color:"#FFF",padding:"10px","border-radius":"6px"}},bubble:null,init:function(n){var r=e.extend(!0,{},t._opts,n);return this.each(function(){var n=e(this),i={width:n.outerWidth(),height:n.outerHeight(),top:parseInt(n.offset().top),left:parseInt(n.offset().left),right:parseInt(n.offset().left)+n.outerWidth(),bottom:parseInt(n.offset().top)+n.outerHeight()},s={},o={};switch(r.position){case"top":s.src=r.arrow.bottom;break;case"right":s.src=r.arrow.left;break;case"bottom":s.src=r.arrow.top;break;case"left":s.src=r.arrow.right;break;default:e.error("Unkown position "+r.position+"for the info bubble")}t.getImageSize(s.src,function(t,u){if(t)return e.error(t);e.extend(s,{pos:{width:parseInt(u.width),height:parseInt(u.height)}});var a=e("<div>	<div class='bubble-container'> 	<img class='bubble-arrow' src='"+s.src+"' />"+"		<div class='bubble-content'></div>"+" </div>"+"</div>");e(".bubble-content",a).html(r.content).css(r.style),a.css({position:"absolute","z-index":"1000",visibility:"hidden"}),e(".bubble-container",a).css({position:"relative"}),e(".bubble-arrow",a).css({position:"absolute",opacity:r.opacity+.1,"z-index":"1500"}),e(".bubble-content",a).css({position:"absolute",top:"0",left:parseInt(u.width)-2+"px",opacity:r.opacity,"z-index":"1000","min-width":parseInt(u.width)*2+5+"px","min-height":parseInt(u.height)*2+5+"px"}),e("body").append(a);var f=(e(".bubble-content",a).outerHeight()-e(".bubble-content",a).innerHeight())/2,l=(e(".bubble-content",a).outerWidth()-e(".bubble-content",a).innerWidth())/2;switch(r.position){case"top":s.pos.top=e(".bubble-content",a).outerHeight()-f,s.pos.left=(e(".bubble-content",a).outerWidth()+s.pos.width)/2,o.top=i.top-e(".bubble-content",a).outerHeight()-s.pos.height,o.left=i.left+i.width/2-e(".bubble-content",a).outerWidth();break;case"right":s.pos.top=(e(".bubble-content",a).outerHeight()-s.pos.height)/2,s.pos.left=0,o.top=i.top+i.height/2,o.left=i.right;break;case"bottom":s.pos.top=f-s.pos.height,s.pos.left=(e(".bubble-content",a).outerWidth()+s.pos.width)/2,o.top=i.bottom+s.pos.height,o.left=i.left+i.width/2-e(".bubble-content",a).outerWidth();break;case"left":s.pos.top=(e(".bubble-content",a).outerHeight()-s.pos.height)/2,s.pos.left=e(".bubble-content",a).innerWidth()+s.pos.width,o.top=i.top+i.height/2,o.left=i.left-e(".bubble-content",a).outerWidth()-s.pos.width-f}var c;for(c in o)a.css(c,o[c]+"px");for(c in s.pos)e(".bubble-arrow",a).css(c,s.pos[c]+"px");a.css({display:"none",visibility:"visible"}),n.data("infobubble",a),n.trigger("infobubblecreate",a),r.display&&n.infoBubble("display")})})},display:function(){this.each(function(){var t=e(this);if(t.data("infobubble")){var n=t.data("infobubble");n.show("slow",function(){t.trigger("infobubbledisplay",n)})}})},close:function(){this.each(function(){var t=e(this);if(t.data("infobubble")){var n=t.data("infobubble");n.hide("slow",function(){t.trigger("infobubbleclose",n)})}})},destroy:function(){this.each(function(){var t=e(this);if(t.data("infobubble")){var n=t.data("infobubble");t.trigger("infobubbledestroy",n),n.remove()}})}};t.getImageSize=function(e,t){e||t("Image source required");var n=new Image;n.onload=function(){t(null,{width:this.width,height:this.height})},n.src=e},e.fn.infoBubble=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.infoBubble")}})(jQuery);