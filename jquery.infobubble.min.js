(function(e){"use strict";var t={_opts:{content:"info bubble",position:"right",arrow:{top:"../resources/arrow_top.png",right:"../resources/arrow_right.png",bottom:"../resources/arrow_bottom.png",left:"../resources/arrow_left.png"},style:{"background-color":"#000",border:"solid 2px #FFF",color:"#FFF",padding:"10px","border-radius":"6px"}},display:function(n){var r=e.extend(!0,{},t._opts,n);return this.each(function(){var n=e(this),i={width:n.outerWidth(),height:n.outerHeight(),top:parseInt(n.offset().top),left:parseInt(n.offset().left),right:parseInt(n.offset().left)+n.outerWidth(),bottom:parseInt(n.offset().top)+n.outerHeight()},s={},o={};switch(r.position){case"top":s.src=r.arrow.bottom;break;case"right":s.src=r.arrow.left;break;case"bottom":s.src=r.arrow.top;break;case"left":s.src=r.arrow.right;break;default:e.error("Unkown position "+r.position+"for the info bubble")}t.getImageSize(s.src,function(t,n){if(t)return e.error(t);e.extend(s,{pos:{width:parseInt(n.width),height:parseInt(n.height)}});var u=e("<div>	<div class='bubble-container'> 	<img class='bubble-arrow' src='"+s.src+"' />"+"		<div class='bubble-content'></div>"+" </div>"+"</div>");e(".bubble-content",u).html(r.content).css(r.style),u.css({position:"absolute","z-index":"1000",visibility:"hidden"}),e(".bubble-container",u).css({position:"relative"}),e(".bubble-arrow",u).css({position:"absolute",opacity:"0.7","z-index":"1500"}),e(".bubble-content",u).css({position:"absolute",top:"0",left:parseInt(n.width)-2+"px",opacity:"0.6","z-index":"1000","min-width":parseInt(n.width)*2+5+"px","min-height":parseInt(n.height)*2+5+"px"}),e("body").append(u);var a=(e(".bubble-content",u).outerHeight()-e(".bubble-content",u).innerHeight())/2,f=(e(".bubble-content",u).outerWidth()-e(".bubble-content",u).innerWidth())/2;switch(r.position){case"top":s.pos.top=e(".bubble-content",u).outerHeight()-a,s.pos.left=(e(".bubble-content",u).outerWidth()+s.pos.width)/2,o.top=i.top-e(".bubble-content",u).outerHeight()-s.pos.height,o.left=i.left+i.width/2-e(".bubble-content",u).outerWidth();break;case"right":s.pos.top=(e(".bubble-content",u).outerHeight()-s.pos.height)/2,s.pos.left=0,o.top=i.top+i.height/2,o.left=i.right;break;case"bottom":s.pos.top=a-s.pos.height,s.pos.left=(e(".bubble-content",u).outerWidth()+s.pos.width)/2,o.top=i.bottom+s.pos.height,o.left=i.left+i.width/2-e(".bubble-content",u).outerWidth();break;case"left":s.pos.top=(e(".bubble-content",u).outerHeight()-s.pos.height)/2,s.pos.left=e(".bubble-content",u).innerWidth()+s.pos.width,o.top=i.top+i.height/2,o.left=i.left-e(".bubble-content",u).outerWidth()-s.pos.width-a}var l;for(l in o)u.css(l,o[l]+"px");for(l in s.pos)e(".bubble-arrow",u).css(l,s.pos[l]+"px");u.css("visibility","visible")})})},destroy:function(){this.each(function(){var t=e(this)})}};t.getImageSize=function(e,t){e||t("Image source required");var n=new Image;n.onload=function(){t(null,{width:this.width,height:this.height})},n.src=e},e.fn.infoBubble=function(e){return t.display.apply(this,arguments)}})(jQuery);